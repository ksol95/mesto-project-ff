(()=>{"use strict";function t(t,e,n,r,o,c){var a=t.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button");return a.setAttribute("id",e._id),i.src=e.link,i.setAttribute("alt",e.name),i.addEventListener("click",(function(){return r(e)})),a.querySelector(".card__title").textContent=e.name,e.owner._id===n?u.addEventListener("click",o):u.classList.add("hidden"),l.addEventListener("click",c),a.querySelector(".card__like-counter").textContent=e.likes.length,e.likes.some((function(t){return t._id===n}))?(a.setAttribute("liked",!0),l.classList.add("card__like-button_is-active")):a.removeAttribute("liked"),a}var e=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__error_visible",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"popup__input_type_error",o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),o.classList.remove(n),o.textContent=""},n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__button_disabled";!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n):e.classList.add(n)},r=function(t,r){var o=t.querySelector(r.submitButtonSelector),c=Array.from(t.querySelectorAll(r.inputSelector));c.forEach((function(n){n.setCustomValidity(""),e(t,n,r.errorClass,r.inputErrorClass)})),o.classList.remove(r.inactiveButtonClass),n(c,o,r.inactiveButtonClass)},o=["image/webp","image/jpeg","image/gif","image/jpg"],c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"a1b07ad8-68b9-4aea-9bd1-7f4f85e9a697","Content-Type":"application/json"}},a=function(t){return t.ok?t.json():Promise.reject(t.status)},i=[new Promise((function(t,e){return fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(n){n.ok&&t(n.json()),e(n.status)}))})),new Promise((function(t,e){return fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(n){n.ok&&t(n.json()),e(n.status)}))}))],u=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)},l=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s)},s=function(t){"Escape"===t.key&&u(document.querySelector(".popup_is-opened"))};function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var p="",f="",_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},m=document.querySelector("#card-template").content,v=document.querySelector(".places__list"),y=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),b=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__image-avatar"),q=document.querySelector(".popup__form[name='editProfileAvatar']"),k=document.querySelector(".profile__image-avatar-button"),x=q.querySelector(".popup__input_type_avatar"),g=document.querySelector(".popup_type_edit_avatar"),C=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup__form[name='editProfile']"),L=E.querySelector(".popup__input_type_name"),A=E.querySelector(".popup__input_type_description"),T=document.querySelector(".profile__add-button"),w=document.querySelector(".popup_type_new-card"),j=document.querySelector(".popup__form[name='new-place']"),P=j.querySelector(".popup__input[name='place-name']"),U=j.querySelector(".popup__input[name='link']"),O=document.querySelector(".popup_type_image"),B=O.querySelector(".popup__image"),D=O.querySelector(".popup__caption"),M=document.querySelectorAll(".popup"),N=document.querySelector(".popup_type_question"),H=N.querySelector(".popup__button"),I=N.querySelector(".popup__title"),J=function(t){I.textContent=t.titleText,H.textContent=t.buttonText,N.setAttribute("data",t.data),H.addEventListener("click",t.handle),l(N)};function V(t){u(N),H.removeEventListener("click",V)}var z=function(t){f=function(t){return t.target.closest(".card").getAttribute("id")}(t),J({titleText:"Вы уверены?",buttonText:"Ок",data:f,handle:$})};function $(t){var e;u(N),(e=f,fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then((function(t){return a(t)}))).then((function(t){!function(t){document.querySelector(".card[id='".concat(t,"']")).remove()}(f)})).catch((function(t){return console.error("Ошибка: ".concat(t))})),H.removeEventListener("click",$)}var F=function(t){var e=t.target,n=e.closest(".card"),r=n.getAttribute("id"),o=n.querySelector(".card__like-counter");n.getAttribute("liked")?function(t){return fetch("".concat(c.baseUrl,"//cards/likes/").concat(t),{method:"DELETE",headers:c.headers}).then((function(t){return a(t)}))}(r).then((function(t){n.removeAttribute("liked"),e.classList.remove("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(t){return J({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:"",handle:V})})):function(t){return fetch("".concat(c.baseUrl,"//cards/likes/").concat(t),{method:"PUT",headers:c.headers}).then((function(t){return a(t)}))}(r).then((function(t){n.setAttribute("liked",!0),e.classList.add("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(t){return J({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:"",handle:V})}))},G=function(t){B.src=t.link,B.alt=t.name,B.title=t.name,D.textContent=t.name,l(O)};T.addEventListener("click",(function(){r(j,_),l(w)})),j.addEventListener("submit",(function(e){e.preventDefault();var n,o,i=j.querySelector(".button");i.textContent="Сохранение...",(n=P.value,o=U.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:n,link:o})}).then((function(t){return a(t)}))).then((function(e){v.prepend(t(m,e,p,G,z,F)),u(w)})).catch((function(e){u(w),J({titleText:"Ошибка: ".concat(e),buttonText:"Ок",data:"",handle:V}),v.append(t(m,{_id:e,link:e,name:e,owner:{_id:p},likes:[]},p,G,z))})).finally((function(){r(j,_),i.textContent="Сохранить",j.reset()}))}));var K=function(t){S.src=t.avatar,y.textContent=t.name,h.textContent=t.about,p=t._id};b.addEventListener("click",(function(){L.value=y.textContent,A.value=h.textContent,r(j,_),l(C)})),E.addEventListener("submit",(function(t){t.preventDefault();var e,n,r=E.querySelector(".button");r.textContent="Сохранение...",(e=L.value,n=A.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:n})}).then((function(t){return a(t)}))).then((function(t){K(t),u(C)})).catch((function(t){u(C),J({titleText:"Ошибочка: ".concat(t),buttonText:"Ок",data:""})})).finally((function(){r.textContent="Сохранить"}))}));k.addEventListener("click",(function(){r(q,_),l(g)})),q.addEventListener("submit",(function(t){t.preventDefault();var e,n=q.querySelector(".button");n.textContent="Сохранение...",(e=x.value,fetch(e,{method:"HEAD"}).then((function(t){var e=t.headers.get("Content-Type");return o.some((function(t){return t===e}))&&t.ok?t.url:Promise.reject(e)}))).then((function(t){var e;(e=t,fetch("".concat(c.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then((function(t){return a(t)}))).then((function(t){var e;u(g),e=t.avatar,S.src=e})).catch((function(t){u(g),J({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:"",handle:V})})).finally((function(){r(q,_),q.reset(),n.textContent="Сохранить"}))})).catch((function(t){u(g),J({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:"",handle:V}),r(q,_)})).finally((function(){return n.textContent="Сохранить"}))})),Promise.all(i).then((function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];K(c),a.forEach((function(e){v.append(t(m,e,p,G,z,F))}))})).catch((function(t){return J({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:"",handle:V})})).finally((function(){(function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(r){r.addEventListener("submit",(function(t){t.preventDefault()}));var o=Array.from(r.querySelectorAll(t.inputSelector)),c=r.querySelector(t.submitButtonSelector);o.forEach((function(a){a.addEventListener("input",(function(){!function(t,n,r,o){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?e(t,n,r,o):function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"popup__error_visible",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"popup__input_type_error",c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),c.textContent=n,c.classList.add(r)}(t,n,n.validationMessage,r,o)}(r,a,t.errorClass,t.inputErrorClass),n(o,c,t.inactiveButtonClass)}))}))}))})(_),function(t){t.forEach((function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){u(t)})),t.addEventListener("click",(function(e){e.target.classList.contains("popup_is-opened")&&u(t)}))}))}(M)}))})();