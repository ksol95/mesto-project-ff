(()=>{"use strict";var t=["image/webp","image/jpeg","image/gif","image/jpg"],e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"a1b07ad8-68b9-4aea-9bd1-7f4f85e9a697","Content-Type":"application/json"}},n=[new Promise((function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){e.ok&&t(e.json()),n(e.status)}))})),new Promise((function(t,n){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){e.ok&&t(e.json()),n(e.status)}))}))],r=document.querySelectorAll(".popup"),o=document.querySelector(".popup_type_question"),a=o.querySelector(".popup__button"),c=o.querySelector(".popup__title"),i=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)},u=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",l)},l=function(t){"Escape"===t.key&&i(document.querySelector(".popup_is-opened"))};function s(t){return new Promise((function(e){c.textContent=t.titleText,a.textContent=t.buttonText,o.setAttribute("data",t.data),a.addEventListener("click",(function(){e(!0),i(o)})),u(o)}))}var d=function(t){var n=t.target.closest(".card"),r=n.getAttribute("id");s({buttonText:"Ок",titleText:"Вы уверены?",data:r}).then((function(){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))})(r).then((function(){n.remove()})).catch((function(t){s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""})}))})).catch((function(t){s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""})}))},p=function(t){var n=t.target,r=n.closest(".card"),o=r.getAttribute("id"),a=r.querySelector(".card__like-counter");r.getAttribute("liked")?function(t){return fetch("".concat(e.baseUrl,"//cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"a1b07ad8-68b9-4aea-9bd1-7f4f85e9a697","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}(o).then((function(t){r.removeAttribute("liked"),n.classList.remove("card__like-button_is-active"),a.textContent=t.likes.length})).catch((function(t){s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""})})):function(t){return fetch("".concat(e.baseUrl,"//cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}(o).then((function(t){r.setAttribute("liked",!0),n.classList.add("card__like-button_is-active"),a.textContent=t.likes.length})).catch((function(t){console.error("Ошибка: ".concat(t)),s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""})}))};function f(t,e,n,r){var o=t.querySelector(".card").cloneNode(!0);return o.setAttribute("id",e._id),o.querySelector(".card__image").src=e.link,o.querySelector(".card__image").setAttribute("alt",e.name),o.querySelector(".card__image").addEventListener("click",r),o.querySelector(".card__title").textContent=e.name,e.owner._id===n?o.querySelector(".card__delete-button").addEventListener("click",d):o.querySelector(".card__delete-button").classList.add("hidden"),o.querySelector(".card__like-button").addEventListener("click",p),o.querySelector(".card__like-counter").textContent=e.likes.length,e.likes.some((function(t){return t._id===n}))?(o.setAttribute("liked",!0),o.querySelector(".card__like-button").classList.add("card__like-button_is-active")):o.removeAttribute("liked"),o}var _=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__error_visible",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"popup__input_type_error",o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),o.classList.remove(n),o.textContent=""},m=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__button_disabled";!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n):e.classList.add(n)},y=function(t,e){var n=t.querySelector(e.submitButtonSelector),r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(n){n.setCustomValidity(""),n.value="",_(t,n,e.errorClass,e.inputErrorClass)})),n.classList.remove(e.inactiveButtonClass),m(r,n,e.inactiveButtonClass)};function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var b="",h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S=document.querySelector("#card-template").content,q=document.querySelector(".places__list"),g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),x=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__image-avatar"),E=document.querySelector(".popup__form[name='editProfileAvatar']"),L=document.querySelector(".profile__image-avatar-button"),A=E.querySelector(".popup__input_type_avatar"),T=document.querySelector(".popup_type_edit_avatar"),j=document.querySelector(".popup_type_edit"),P=document.querySelector(".popup__form[name='editProfile']"),w=P.querySelector(".popup__input_type_name"),U=P.querySelector(".popup__input_type_description"),O=document.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup__form[name='new-place']"),M=D.querySelector(".popup__input[name='place-name']"),N=D.querySelector(".popup__input[name='link']"),H=document.querySelector(".popup_type_image"),I=H.querySelector(".popup__image"),J=H.querySelector(".popup__caption"),V=function(t){I.src=t.target.getAttribute("src"),I.alt=t.target.getAttribute("alt"),I.title=t.target.getAttribute("alt"),J.textContent=t.target.getAttribute("alt"),u(H)};O.addEventListener("click",(function(){y(D,h),u(B)})),D.addEventListener("submit",(function(t){var n,r;t.preventDefault(),D.querySelector(".button").textContent="Сохранение...",(n=M.value,r=N.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:r})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){q.prepend(f(S,t,b,V))})).catch((function(t){s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""}),q.append(f(S,{_id:t,link:t,name:t,owner:{_id:b},likes:[]},b,V)).finally((function(){y(D,h),D.querySelector(".button").textContent="Сохранить"}))})),i(B),t.target.reset()}));var z=function(t){g.textContent=t.name,k.textContent=t.about,C.src=t.avatar,b=t._id};x.addEventListener("click",(function(){y(D,h),w.value=g.textContent,U.value=k.textContent,u(j)})),P.addEventListener("submit",(function(t){var n,r;t.preventDefault(),P.querySelector(".button").textContent="Сохранение...",(n=w.value,r=U.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){return z(t)})).catch((function(t){return z({name:"Ошибка: ".concat(t),about:"Ошибка: ".concat(t)})})).finally((function(){P.querySelector(".button").textContent="Сохранить",i(j)}))}));L.addEventListener("click",(function(){y(E,h),u(T)})),E.addEventListener("submit",(function(n){var r;n.preventDefault(),E.querySelector(".button").textContent="Сохранение...",(r=A.value,fetch(r,{method:"HEAD"}).then((function(e){var n=e.headers.get("Content-Type");return t.some((function(t){return t===n}))&&e.ok?e.url:Promise.reject(n)}))).then((function(t){var n;(n=t,fetch("".concat(e.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){return e=t.avatar,void(C.src=e);var e})).catch((function(t){return s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""})})).finally((function(){y(E,h),i(T)}))})).catch((function(t){s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""}),y(E,h)})),E.querySelector(".button").textContent="Сохранить"})),Promise.all(n).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];z(o),a.forEach((function(t){q.append(f(S,t,b,V))}))})).catch((function(t){return s({titleText:"Ошибка: ".concat(t),buttonText:"Ок",data:""})})).finally((function(){(function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?_(t,e,n,r):function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"popup__error_visible",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"popup__input_type_error",a=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),a.textContent=n,a.classList.add(r)}(t,e,e.validationMessage,n,r)}(e,o,t.errorClass,t.inputErrorClass),m(n,r,t.inactiveButtonClass)}))}))}))})(h),r.forEach((function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){i(t)})),t.addEventListener("click",(function(e){e.target.classList.contains("popup_is-opened")&&i(t)}))}))}))})();